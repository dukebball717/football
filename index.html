<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Scorer Realtime</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
button { margin:5px; padding:10px 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background-color:#f2f2f2; }
</style>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.16.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.16.0/firebase-database-compat.js"></script>
</head>
<body>

<h2>Football Scorer (Realtime)</h2>

<select id="manualPlayer">
  <option value="Russell">Russell</option>
  <option value="Daniel">Daniel</option>
  <option value="Zach">Zach</option>
</select>

<br><br>
<button onclick="score('FG')">Field Goal ($1)</button>
<button onclick="score('TD')">Touchdown ($4)</button>
<button onclick="score('Safety')">Safety ($5)</button>
<button onclick="score('STTD')">Special Teams TD ($7)</button>
<button onclick="score('DefTD')">Defensive TD ($7)</button>
<button onclick="undoScore()">Undo Last Score</button>

<h3>Scores</h3>
<p id="scoreR">Russell: $0</p>
<p id="scoreD">Daniel: $0</p>
<p id="scoreZ">Zach: $0</p>

<h3>History</h3>
<table id="historyTable">
<thead><tr><th>Player</th><th>Type</th><th>Amount</th></tr></thead>
<tbody></tbody>
</table>

<h3>Winner Collects Excess</h3>
<table id="payoutTable">
<thead><tr><th>Player</th><th>Net Payout</th></tr></thead>
<tbody></tbody>
</table>

<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyDqwcqGLWy9aymraJr7dz3plPBXiVqB5mk",
  authDomain: "scoring-19eca.firebaseapp.com",
  databaseURL: "https://scoring-19eca-default-rtdb.firebaseio.com",
  projectId: "scoring-19eca",
  storageBucket: "scoring-19eca.firebasestorage.app",
  messagingSenderId: "11549172317",
  appId: "1:11549172317:web:327604b364a30b569a63b4"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Tracker State ---
let scores = {Russell:0, Daniel:0, Zach:0};
let history = [];
const values = {FG:1, TD:4, Safety:5, STTD:7, DefTD:7};

// --- Functions ---
function getPlayer(){ return document.getElementById('manualPlayer').value; }

function score(type){
  const player = getPlayer();
  const amount = values[type];
  scores[player] += amount;
  history.push({player,type,amount});
  updateAll();
  pushScores();
}

function undoScore(){
  if(history.length===0) return;
  const last = history.pop();
  scores[last.player] -= last.amount;
  updateAll();
  pushScores();
}

function updateAll(){
  document.getElementById('scoreR').innerText = `Russell: $${scores.Russell}`;
  document.getElementById('scoreD').innerText = `Daniel: $${scores.Daniel}`;
  document.getElementById('scoreZ').innerText = `Zach: $${scores.Zach}`;
  
  const tbody = document.querySelector('#historyTable tbody');
  tbody.innerHTML = '';
  history.forEach(h=>{
    const row = document.createElement('tr');
    row.innerHTML = `<td>${h.player}</td><td>${h.type}</td><td>$${h.amount}</td>`;
    tbody.appendChild(row);
  });

  // Zero-sum payouts
  const players = Object.keys(scores);
  let winner = players[0];
  players.forEach(p=>{if(scores[p]>scores[winner]) winner=p;});
  const ptbody = document.querySelector('#payoutTable tbody');
  ptbody.innerHTML = '';
  players.forEach(p=>{
    let net = (p===winner)?players.reduce((sum,o)=>o!==winner?sum+(scores[winner]-scores[o]):sum,0):scores[p]-scores[winner];
    const row = document.createElement('tr');
    row.innerHTML = `<td>${p}</td><td>$${net}</td>`;
    ptbody.appendChild(row);
  });
}

// --- Firebase Functions ---
function pushScores(){
  db.ref('game/current').set({scores,history});
}

db.ref('game/current').on('value',snapshot=>{
  const data = snapshot.val();
  if(!data) return;
  scores=data.scores;
  history=data.history;
  updateAll();
});

updateAll();
</script>
</body>
</html>
